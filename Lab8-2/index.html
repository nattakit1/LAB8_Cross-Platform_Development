<!DOCTYPE html>
<html lang="th">
<head>
  <meta charset="UTF-8">
  <meta name="viewport" content="width=device-width, initial-scale=1.0">
  <title>Lab 8.2 - IPC Communication Demo with Login</title>
  <style>
    body {
      font-family: 'Segoe UI', Tahoma, Geneva, Verdana, sans-serif;
      margin: 0;
      padding: 20px;
      background: linear-gradient(135deg, #667eea 0%, #764ba2 100%);
      color: white;
    }
    .container {
      max-width: 900px;
      margin: 0 auto;
      background: rgba(255, 255, 255, 0.1);
      padding: 30px;
      border-radius: 15px;
      backdrop-filter: blur(10px);
    }
    .header {
      text-align: center;
      margin-bottom: 30px;
    }
    .demo-section {
      background: rgba(255, 255, 255, 0.1);
      padding: 20px;
      border-radius: 10px;
      margin-bottom: 20px;
    }
    .input-group {
      margin: 15px 0;
    }
    .input-group label {
      display: block;
      margin-bottom: 5px;
      font-weight: bold;
    }
    .input-group input {
      width: 100%;
      padding: 10px;
      border: none;
      border-radius: 5px;
      font-size: 16px;
      box-sizing: border-box;
    }
    .button {
      background: rgba(255, 255, 255, 0.2);
      border: 2px solid white;
      color: white;
      padding: 12px 24px;
      border-radius: 25px;
      cursor: pointer;
      font-size: 16px;
      margin: 10px 5px;
      transition: all 0.3s ease;
    }
    .button:hover {
      background: white;
      color: #667eea;
      transform: translateY(-2px);
    }
    .result-box {
      background: rgba(0, 0, 0, 0.2);
      padding: 15px;
      border-radius: 8px;
      margin-top: 15px;
      font-family: monospace;
      white-space: pre-wrap;
      max-height: 200px;
      overflow-y: auto;
    }
    .loading { color: #ffd700; font-style: italic; }
    .success { color: #90ee90; }
    .error { color: #ff6b6b; }
  </style>
</head>
<body>
  <div class="container">
    <div class="header">
      <h1>üîÑ IPC Communication Demo</h1>
      <p>‡∏Å‡∏≤‡∏£‡∏™‡∏∑‡πà‡∏≠‡∏™‡∏≤‡∏£‡∏£‡∏∞‡∏´‡∏ß‡πà‡∏≤‡∏á Main Process ‡πÅ‡∏•‡∏∞ Renderer Process</p>
    </div>

    <!-- Login Section -->
    <div class="demo-section" id="loginSection">
      <h3>üîê Login Agent</h3>
      <div class="input-group">
        <label>Agent ID:</label>
        <input type="text" id="loginAgentId" placeholder="‡πÉ‡∏™‡πà Agent ID...">
      </div>
      <div class="input-group">
        <label>Password:</label>
        <input type="password" id="loginPassword" placeholder="‡πÉ‡∏™‡πà‡∏£‡∏´‡∏±‡∏™‡∏ú‡πà‡∏≤‡∏ô...">
      </div>
      <button class="button" onclick="login()">Login</button>
      <div class="result-box" id="loginResult">‡∏Å‡∏£‡∏≠‡∏Å‡∏Ç‡πâ‡∏≠‡∏°‡∏π‡∏•‡πÅ‡∏•‡∏∞‡∏Å‡∏î Login</div>
    </div>

    <!-- Dashboard Section -->
    <div class="demo-section" id="dashboardSection" style="display:none;">
      <h3>üìä Dashboard</h3>
      <p>‡∏™‡∏ß‡∏±‡∏™‡∏î‡∏µ <span id="dashboardAgentName"></span></p>
      <p>‡∏™‡∏ñ‡∏≤‡∏ô‡∏∞‡∏õ‡∏±‡∏à‡∏à‡∏∏‡∏ö‡∏±‡∏ô: <span id="agentStatus">Offline</span></p>
      <button class="button" onclick="changeStatus('Available')">Available</button>
      <button class="button" onclick="changeStatus('Busy')">Busy</button>
      <button class="button" onclick="changeStatus('Offline')">Offline</button>
      <h4>‡∏™‡∏ñ‡∏¥‡∏ï‡∏¥‡∏™‡πà‡∏ß‡∏ô‡∏ï‡∏±‡∏ß</h4>
      <pre id="agentStats"></pre>
    </div>

    <!-- Demo 1: ‡∏™‡πà‡∏á‡∏Ç‡πâ‡∏≠‡∏Ñ‡∏ß‡∏≤‡∏°‡∏û‡∏∑‡πâ‡∏ô‡∏ê‡∏≤‡∏ô -->
    <div class="demo-section">
      <h3>üì§ Demo 1: ‡∏™‡πà‡∏á‡∏Ç‡πâ‡∏≠‡∏Ñ‡∏ß‡∏≤‡∏°‡πÑ‡∏õ Main Process</h3>
      <p>‡∏ó‡∏î‡∏™‡∏≠‡∏ö‡∏Å‡∏≤‡∏£‡∏™‡πà‡∏á‡∏Ç‡πâ‡∏≠‡∏Ñ‡∏ß‡∏≤‡∏°‡πÅ‡∏•‡∏∞‡∏£‡∏±‡∏ö response ‡∏Å‡∏•‡∏±‡∏ö‡∏°‡∏≤</p>
      <div class="input-group">
        <label>‡∏Ç‡πâ‡∏≠‡∏Ñ‡∏ß‡∏≤‡∏°‡∏ó‡∏µ‡πà‡∏ï‡πâ‡∏≠‡∏á‡∏Å‡∏≤‡∏£‡∏™‡πà‡∏á:</label>
        <input type="text" id="messageInput" placeholder="‡∏û‡∏¥‡∏°‡∏û‡πå‡∏Ç‡πâ‡∏≠‡∏Ñ‡∏ß‡∏≤‡∏°‡∏ó‡∏µ‡πà‡∏ô‡∏µ‡πà..." value="Hello from Renderer Process!">
      </div>
      <button class="button" onclick="sendMessage()">üì§ ‡∏™‡πà‡∏á‡∏Ç‡πâ‡∏≠‡∏Ñ‡∏ß‡∏≤‡∏°</button>
      <button class="button" onclick="clearResult('messageResult')">üßπ ‡πÄ‡∏Ñ‡∏•‡∏µ‡∏¢‡∏£‡πå</button>
      <div class="result-box" id="messageResult">‡∏Å‡∏î‡∏õ‡∏∏‡πà‡∏° "‡∏™‡πà‡∏á‡∏Ç‡πâ‡∏≠‡∏Ñ‡∏ß‡∏≤‡∏°" ‡πÄ‡∏û‡∏∑‡πà‡∏≠‡∏ó‡∏î‡∏™‡∏≠‡∏ö IPC</div>
    </div>

    <!-- Demo 2: ‡∏£‡∏∞‡∏ö‡∏ö‡∏ó‡∏±‡∏Å‡∏ó‡∏≤‡∏¢ -->
    <div class="demo-section">
      <h3>üëã Demo 2: ‡∏£‡∏∞‡∏ö‡∏ö‡∏ó‡∏±‡∏Å‡∏ó‡∏≤‡∏¢ Agent</h3>
      <p>‡∏à‡∏≥‡∏•‡∏≠‡∏á‡∏Å‡∏≤‡∏£ login ‡πÅ‡∏•‡∏∞‡∏ó‡∏±‡∏Å‡∏ó‡∏≤‡∏¢‡πÄ‡∏´‡∏°‡∏∑‡∏≠‡∏ô‡πÉ‡∏ô agent wallboard</p>
      <div class="input-group">
        <label>‡∏ä‡∏∑‡πà‡∏≠ Agent:</label>
        <input type="text" id="agentName" placeholder="‡πÉ‡∏™‡πà‡∏ä‡∏∑‡πà‡∏≠‡∏Ç‡∏≠‡∏á‡∏Ñ‡∏∏‡∏ì..." value="Agent001">
      </div>
      <button class="button" onclick="sayHello()">üëã ‡πÄ‡∏Ç‡πâ‡∏≤‡∏™‡∏π‡πà‡∏£‡∏∞‡∏ö‡∏ö</button>
      <button class="button" onclick="clearResult('helloResult')">üßπ ‡πÄ‡∏Ñ‡∏•‡∏µ‡∏¢‡∏£‡πå</button>
      <div class="result-box" id="helloResult">‡∏Å‡∏î‡∏õ‡∏∏‡πà‡∏° "‡πÄ‡∏Ç‡πâ‡∏≤‡∏™‡∏π‡πà‡∏£‡∏∞‡∏ö‡∏ö" ‡πÄ‡∏û‡∏∑‡πà‡∏≠‡∏ó‡∏î‡∏™‡∏≠‡∏ö‡∏£‡∏∞‡∏ö‡∏ö‡∏ó‡∏±‡∏Å‡∏ó‡∏≤‡∏¢</div>
    </div>

    <!-- ‡∏Ç‡πâ‡∏≠‡∏°‡∏π‡∏• Process -->
    <div class="demo-section">
      <h3>üìä Process Information</h3>
      <div class="result-box">
üñ•Ô∏è <strong>Main Process:</strong> ‡∏ó‡∏≥‡∏á‡∏≤‡∏ô‡πÉ‡∏ô Node.js environment, ‡∏à‡∏±‡∏î‡∏Å‡∏≤‡∏£ business logic
üé® <strong>Renderer Process:</strong> ‡∏ó‡∏≥‡∏á‡∏≤‡∏ô‡πÉ‡∏ô Chromium environment, ‡πÅ‡∏™‡∏î‡∏á UI
üåâ <strong>Preload Script:</strong> ‡∏ï‡∏±‡∏ß‡∏Å‡∏•‡∏≤‡∏á‡∏ó‡∏µ‡πà‡∏õ‡∏•‡∏≠‡∏î‡∏†‡∏±‡∏¢‡∏™‡∏≥‡∏´‡∏£‡∏±‡∏ö IPC communication

<strong>üîÑ ‡∏Å‡∏≤‡∏£‡∏ó‡∏≥‡∏á‡∏≤‡∏ô:</strong>
1. Renderer ‡πÄ‡∏£‡∏µ‡∏¢‡∏Å window.electronAPI.sendMessage()
2. Preload ‡∏™‡πà‡∏á‡∏ï‡πà‡∏≠‡πÑ‡∏õ Main ‡∏î‡πâ‡∏ß‡∏¢ ipcRenderer.invoke()
3. Main ‡∏õ‡∏£‡∏∞‡∏°‡∏ß‡∏•‡∏ú‡∏•‡∏î‡πâ‡∏ß‡∏¢ ipcMain.handle()
4. Main ‡∏™‡πà‡∏á response ‡∏Å‡∏•‡∏±‡∏ö
5. Renderer ‡πÑ‡∏î‡πâ‡∏£‡∏±‡∏ö‡∏ú‡∏•‡∏•‡∏±‡∏û‡∏ò‡πå
      </div>
    </div>
  </div>

<script>
console.log('üé® [RENDERER] ‡∏Å‡∏≥‡∏•‡∏±‡∏á‡πÇ‡∏´‡∏•‡∏î...');
if (window.electronAPI) console.log('‚úÖ [RENDERER] electronAPI ‡∏û‡∏£‡πâ‡∏≠‡∏°‡πÉ‡∏ä‡πâ‡∏á‡∏≤‡∏ô');
else console.error('‚ùå [RENDERER] electronAPI ‡πÑ‡∏°‡πà‡∏û‡∏£‡πâ‡∏≠‡∏°‡πÉ‡∏ä‡πâ‡∏á‡∏≤‡∏ô');

let currentAgent = null;

// ‡∏ü‡∏±‡∏á‡∏Å‡πå‡∏ä‡∏±‡∏ô Login
async function login() {
  const agentId = document.getElementById('loginAgentId').value.trim();
  const password = document.getElementById('loginPassword').value.trim();
  if (!agentId || !password) {
    displayResult('loginResult', '‡∏Å‡∏£‡∏∏‡∏ì‡∏≤‡∏Å‡∏£‡∏≠‡∏Å Agent ID ‡πÅ‡∏•‡∏∞ Password', 'error');
    return;
  }
  displayResult('loginResult', '‡∏Å‡∏≥‡∏•‡∏±‡∏á‡∏ï‡∏£‡∏ß‡∏à‡∏™‡∏≠‡∏ö...', 'loading');
  try {
    const response = await window.electronAPI.authenticate({ agentId, password });
    if (response.success) {
      currentAgent = response.agent;
      displayResult('loginResult', 'Login ‡∏™‡∏≥‡πÄ‡∏£‡πá‡∏à', 'success');
      showDashboard();
    } else displayResult('loginResult', response.error, 'error');
  } catch (err) {
    displayResult('loginResult', `Error: ${err.message}`, 'error');
  }
}

// ‡πÅ‡∏™‡∏î‡∏á Dashboard
function showDashboard() {
  document.getElementById('loginSection').style.display = 'none';
  document.getElementById('dashboardSection').style.display = 'block';
  document.getElementById('dashboardAgentName').textContent = currentAgent.name;
  document.getElementById('agentStatus').textContent = currentAgent.status || 'Offline';
  document.getElementById('agentStats').textContent = JSON.stringify(currentAgent.statistics || {}, null, 2);
}

// ‡πÄ‡∏õ‡∏•‡∏µ‡πà‡∏¢‡∏ô‡∏™‡∏ñ‡∏≤‡∏ô‡∏∞‡∏ï‡∏±‡∏ß‡πÄ‡∏≠‡∏á
async function changeStatus(newStatus) {
  if (!currentAgent) return;
  const result = await window.electronAPI.changeAgentStatus({ agentId: currentAgent.id, newStatus });
  if (result.success) {
    currentAgent = result.agent;
    document.getElementById('agentStatus').textContent = currentAgent.status;
    document.getElementById('agentStats').textContent = JSON.stringify(result.statistics || {}, null, 2);
  }
}

// ‡∏£‡∏±‡∏ö Notification ‡πÄ‡∏°‡∏∑‡πà‡∏≠‡∏°‡∏µ agent ‡∏≠‡∏±‡∏û‡πÄ‡∏î‡∏ï‡∏™‡∏ñ‡∏≤‡∏ô‡∏∞
window.electronAPI.onAgentStatusUpdated((data) => {
  const { agent } = data;
  if (agent.id !== currentAgent?.id) {
    alert(`üîî Agent ${agent.name} ‡πÄ‡∏õ‡∏•‡∏µ‡πà‡∏¢‡∏ô‡∏™‡∏ñ‡∏≤‡∏ô‡∏∞‡πÄ‡∏õ‡πá‡∏ô ${agent.status}`);
  }
});

// ‡∏ü‡∏±‡∏á‡∏Å‡πå‡∏ä‡∏±‡∏ô‡πÅ‡∏™‡∏î‡∏á‡∏ú‡∏•‡∏•‡∏±‡∏û‡∏ò‡πå‡∏ó‡∏±‡πà‡∏ß‡πÑ‡∏õ
function displayResult(elementId, data, type = 'info') {
  const element = document.getElementById(elementId);
  const timestamp = new Date().toLocaleTimeString('th-TH');
  let content = typeof data === 'object' ? JSON.stringify(data, null, 2) : data.toString();
  element.innerHTML = `[${timestamp}] ${content}`;
  element.className = `result-box ${type}`;
}

// ‡∏™‡πà‡∏á‡∏Ç‡πâ‡∏≠‡∏Ñ‡∏ß‡∏≤‡∏°
async function sendMessage() {
  const message = document.getElementById('messageInput').value;
  if (!message.trim()) { displayResult('messageResult', '‡∏Å‡∏£‡∏∏‡∏ì‡∏≤‡πÉ‡∏™‡πà‡∏Ç‡πâ‡∏≠‡∏Ñ‡∏ß‡∏≤‡∏°', 'error'); return; }
  try {
    displayResult('messageResult', '‡∏Å‡∏≥‡∏•‡∏±‡∏á‡∏™‡πà‡∏á‡∏Ç‡πâ‡∏≠‡∏Ñ‡∏ß‡∏≤‡∏°...', 'loading');
    const response = await window.electronAPI.sendMessage(message);
    displayResult('messageResult', response, 'success');
  } catch (error) { displayResult('messageResult', `Error: ${error.message}`, 'error'); }
}

// ‡∏ó‡∏±‡∏Å‡∏ó‡∏≤‡∏¢
async function sayHello() {
  const name = document.getElementById('agentName').value;
  if (!name.trim()) { displayResult('helloResult', '‡∏Å‡∏£‡∏∏‡∏ì‡∏≤‡πÉ‡∏™‡πà‡∏ä‡∏∑‡πà‡∏≠ Agent', 'error'); return; }
  try {
    displayResult('helloResult', '‡∏Å‡∏≥‡∏•‡∏±‡∏á‡πÄ‡∏Ç‡πâ‡∏≤‡∏™‡∏π‡πà‡∏£‡∏∞‡∏ö‡∏ö...', 'loading');
    const response = await window.electronAPI.sayHello(name);
    const resultText = `
üéâ ‡πÄ‡∏Ç‡πâ‡∏≤‡∏™‡∏π‡πà‡∏£‡∏∞‡∏ö‡∏ö‡∏™‡∏≥‡πÄ‡∏£‡πá‡∏à!
üë§ Agent: ${response.name}
üí¨ ‡∏Ç‡πâ‡∏≠‡∏Ñ‡∏ß‡∏≤‡∏°: ${response.greeting}
‚è∞ ‡πÄ‡∏ß‡∏•‡∏≤: ${response.time}
üë• Agents ‡∏≠‡∏≠‡∏ô‡πÑ‡∏•‡∏ô‡πå: ${response.agentCount} ‡∏Ñ‡∏ô
‚úÖ ‡∏û‡∏£‡πâ‡∏≠‡∏°‡∏ó‡∏≥‡∏á‡∏≤‡∏ô‡πÅ‡∏•‡πâ‡∏ß!`;
    displayResult('helloResult', resultText, 'success');
  } catch (error) { displayResult('helloResult', `Error: ${error.message}`, 'error'); }
}

// ‡πÄ‡∏Ñ‡∏•‡∏µ‡∏¢‡∏£‡πå‡∏ú‡∏•‡∏•‡∏±‡∏û‡∏ò‡πå
function clearResult(elementId) {
  const element = document.getElementById(elementId);
  element.innerHTML = '‡πÄ‡∏Ñ‡∏•‡∏µ‡∏¢‡∏£‡πå‡πÅ‡∏•‡πâ‡∏ß...';
  element.className = 'result-box';
}

document.getElementById('messageInput').addEventListener('keypress', e => { if (e.key==='Enter') sendMessage(); });
document.getElementById('agentName').addEventListener('keypress', e => { if (e.key==='Enter') sayHello(); });

window.addEventListener('DOMContentLoaded', ()=>console.log('üìÑ [RENDERER] HTML ‡πÇ‡∏´‡∏•‡∏î‡πÄ‡∏™‡∏£‡πá‡∏à'));
window.addEventListener('load', ()=>console.log('‚úÖ [RENDERER] ‡∏ó‡∏∏‡∏Å‡∏≠‡∏¢‡πà‡∏≤‡∏á‡∏û‡∏£‡πâ‡∏≠‡∏°‡πÅ‡∏•‡πâ‡∏ß'));


</script>
</body>
</html>
